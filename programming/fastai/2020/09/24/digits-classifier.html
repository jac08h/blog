<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Recognizing hand-written digits - SGD from scratch | jac08h’s blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Recognizing hand-written digits - SGD from scratch" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Classify digits from MNIST dataset using a Stochastic Gradient Descent" />
<meta property="og:description" content="Classify digits from MNIST dataset using a Stochastic Gradient Descent" />
<link rel="canonical" href="https://jac08h.github.io/blog/programming/fastai/2020/09/24/digits-classifier.html" />
<meta property="og:url" content="https://jac08h.github.io/blog/programming/fastai/2020/09/24/digits-classifier.html" />
<meta property="og:site_name" content="jac08h’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-24T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://jac08h.github.io/blog/programming/fastai/2020/09/24/digits-classifier.html","@type":"BlogPosting","headline":"Recognizing hand-written digits - SGD from scratch","dateModified":"2020-09-24T00:00:00-05:00","datePublished":"2020-09-24T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jac08h.github.io/blog/programming/fastai/2020/09/24/digits-classifier.html"},"description":"Classify digits from MNIST dataset using a Stochastic Gradient Descent","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://jac08h.github.io/blog/feed.xml" title="jac08h's blog" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">jac08h&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a><a class="page-link" href="https://jac08h.github.io">Website</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Recognizing hand-written digits - SGD from scratch</h1><p class="page-description">Classify digits from MNIST dataset using a Stochastic Gradient Descent</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-09-24T00:00:00-05:00" itemprop="datePublished">
        Sep 24, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      14 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#programming">programming</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#fastai">fastai</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/jac08h/blog/tree/master/_notebooks/2020-09-24-digits-classifier.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/jac08h/blog/blob/master/_notebooks/2020-09-24-digits-classifier.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Objective">Objective </a></li>
<li class="toc-entry toc-h2"><a href="#Steps">Steps </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Download,-sort,-show">Download, sort, show </a></li>
<li class="toc-entry toc-h3"><a href="#Measuring-the-difference:-Pixel-similarity">Measuring the difference: Pixel similarity </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Creating-"average"-digits">Creating &quot;average&quot; digits </a></li>
<li class="toc-entry toc-h4"><a href="#Measuring-the-similarity">Measuring the similarity </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Calculating-accuracy">Calculating accuracy </a></li>
<li class="toc-entry toc-h3"><a href="#Stochastic-Gradient-Descent">Stochastic Gradient Descent </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Step-2:-Calculate-the-predictions">Step 2: Calculate the predictions </a></li>
<li class="toc-entry toc-h4"><a href="#Step-3:-Calculate-the-loss">Step 3: Calculate the loss </a></li>
<li class="toc-entry toc-h4"><a href="#Step-4:-Calculate-the-gradients">Step 4: Calculate the gradients </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Creating-an-Optimizer">Creating an Optimizer </a></li>
<li class="toc-entry toc-h3"><a href="#More-layers-and-nonlinearity">More layers and nonlinearity </a></li>
<li class="toc-entry toc-h3"><a href="#Final-remarks">Final remarks </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-09-24-digits-classifier.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Inspired by <a href="https://github.com/fastai/fastbook/blob/master/04_mnist_basics.ipynb">chapter 4</a> in <a href="https://github.com/fastai/fastbook">The fastai book</a>. Check it out for more detailed description of the steps.</p>
<p>The book discusses problem of classifying 3s and 7s. Here, I tackle the same classification, but with all ten digits.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Objective">
<a class="anchor" href="#Objective" aria-hidden="true"><span class="octicon octicon-link"></span></a>Objective<a class="anchor-link" href="#Objective"> </a>
</h2>
<p>Design a model that can classify hand-written digits from MNIST dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Steps">
<a class="anchor" href="#Steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Steps<a class="anchor-link" href="#Steps"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Download,-sort,-show">
<a class="anchor" href="#Download,-sort,-show" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download, sort, show<a class="anchor-link" href="#Download,-sort,-show"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Download the dataset.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">'training'</span><span class="p">)</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#10) [Path('training/0'),Path('training/2'),Path('training/9'),Path('training/8'),Path('training/7'),Path('training/1'),Path('training/5'),Path('training/4'),Path('training/6'),Path('training/3')]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Store the image paths to a nested list.
We can access the images for every digit by indexing the container. Since the python indexing starts from 0, the indexes conveniently follow the underlying digits.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">current_digit_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">'training'</span><span class="o">/</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">current_digit</span> <span class="o">=</span> <span class="n">current_digit_path</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span><span class="o">.</span><span class="n">sorted</span><span class="p">()</span>
    <span class="n">digits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_digit</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">twos</span> <span class="o">=</span> <span class="n">digits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">im2_path</span> <span class="o">=</span> <span class="n">twos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im2_path</span><span class="p">)</span>
<span class="n">im2</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAAAAABXZoBIAAAA5klEQVR4nGNgoAlghLMCjUS1GOQbF//Goorv4t9Pnz79/redE4uk5JN4BgaGwl//bktgSnJrMjAwMDAEXPq3XAynI7z//SuEsZnQJS8+ZDDAqZOh5t99EVw6Ga4xyHPhlEQCJEoqMjz/gUu1+J1/C2FsFoQwjxsDAwMDtxLDTUwtZmv//fv379+rfw8ww4/rwL8DPqrT//37d9wGQ7L9311uBvHOf//+/fvcgW4nH0PPV0+nYoaOSRkiumKvUHVO/bek8NK/f+0sDAwM7OgejPn379+/J7rMWP3He+7//wksWKUGDwAAA71NLUTZxVkAAAAASUVORK5CYII=%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The images are represented by pixels, each of which holds the value from 0 (black) to 255 (white), with gradients of grey between. For example, 20 would be <em>almost</em> black.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see the underlying representation of images by converting them to NumPy array...</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">array</span><span class="p">(</span><span class="n">im2</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[  0,   0,   0,   0,   0,   0],
       [  0,   0,   0,  81, 131, 152],
       [  0,   0,  14, 209, 253, 242],
       [  0,   0,  25, 228,  95,   0],
       [  0,   0,  11,  41,   0,   0]], dtype=uint8)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>...or by creating a Pandas dataframe from tensor, and then plotting the grey-scale using the pixel values.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">im2_t</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">im2</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">im2_t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">'font-size'</span><span class="p">:</span><span class="s1">'6pt'</span><span class="p">})</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="s1">'Greys'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<style type="text/css">
#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col0,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col1,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col9{
            font-size:  6pt;
            background-color:  #ffffff;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col3{
            font-size:  6pt;
            background-color:  #c2c2c2;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col4{
            font-size:  6pt;
            background-color:  #919191;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col5{
            font-size:  6pt;
            background-color:  #727272;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col7{
            font-size:  6pt;
            background-color:  #3f3f3f;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col8{
            font-size:  6pt;
            background-color:  #1e1e1e;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col9{
            font-size:  6pt;
            background-color:  #bababa;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col10{
            font-size:  6pt;
            background-color:  #fdfdfd;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col2{
            font-size:  6pt;
            background-color:  #858585;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col3{
            font-size:  6pt;
            background-color:  #181818;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col4,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col5,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col6,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col7,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col9,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col2,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col3,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col10,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col12{
            font-size:  6pt;
            background-color:  #000000;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col10{
            font-size:  6pt;
            background-color:  #5a5a5a;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col11{
            font-size:  6pt;
            background-color:  #fbfbfb;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col4{
            font-size:  6pt;
            background-color:  #bdbdbd;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col8,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col11{
            font-size:  6pt;
            background-color:  #a5a5a5;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col9{
            font-size:  6pt;
            background-color:  #050505;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col11{
            font-size:  6pt;
            background-color:  #292929;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col12,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col10{
            font-size:  6pt;
            background-color:  #f4f4f4;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col2{
            font-size:  6pt;
            background-color:  #a9a9a9;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col3{
            font-size:  6pt;
            background-color:  #e6e6e6;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col9{
            font-size:  6pt;
            background-color:  #cbcbcb;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col10{
            font-size:  6pt;
            background-color:  #363636;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col12{
            font-size:  6pt;
            background-color:  #6a6a6a;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col13{
            font-size:  6pt;
            background-color:  #f5f5f5;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col10{
            font-size:  6pt;
            background-color:  #cfcfcf;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col13{
            font-size:  6pt;
            background-color:  #a8a8a8;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col10{
            font-size:  6pt;
            background-color:  #f2f2f2;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col13{
            font-size:  6pt;
            background-color:  #242424;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col13,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col13{
            font-size:  6pt;
            background-color:  #707070;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col11{
            font-size:  6pt;
            background-color:  #9a9a9a;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col11,#T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col11{
            font-size:  6pt;
            background-color:  #c9c9c9;
            color:  #000000;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col13{
            font-size:  6pt;
            background-color:  #1d1d1d;
            color:  #f1f1f1;
        }#T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col11{
            font-size:  6pt;
            background-color:  #282828;
            color:  #f1f1f1;
        }</style>
<table id="T_b5b971e0_0254_11eb_bcbe_0242ac110002">
<thead>    <tr>        <th class="blank level0"></th>        <th class="col_heading level0 col0">0</th>        <th class="col_heading level0 col1">1</th>        <th class="col_heading level0 col2">2</th>        <th class="col_heading level0 col3">3</th>        <th class="col_heading level0 col4">4</th>        <th class="col_heading level0 col5">5</th>        <th class="col_heading level0 col6">6</th>        <th class="col_heading level0 col7">7</th>        <th class="col_heading level0 col8">8</th>        <th class="col_heading level0 col9">9</th>        <th class="col_heading level0 col10">10</th>        <th class="col_heading level0 col11">11</th>        <th class="col_heading level0 col12">12</th>        <th class="col_heading level0 col13">13</th>    </tr>
</thead>
<tbody>
                <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row0" class="row_heading level0 row0">0</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col0" class="data row0 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col1" class="data row0 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col2" class="data row0 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col3" class="data row0 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col4" class="data row0 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col5" class="data row0 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col6" class="data row0 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col7" class="data row0 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col8" class="data row0 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col9" class="data row0 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col10" class="data row0 col10">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col11" class="data row0 col11">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col12" class="data row0 col12">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row0_col13" class="data row0 col13">0</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row1" class="row_heading level0 row1">1</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col0" class="data row1 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col1" class="data row1 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col2" class="data row1 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col3" class="data row1 col3">81</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col4" class="data row1 col4">131</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col5" class="data row1 col5">152</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col6" class="data row1 col6">194</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col7" class="data row1 col7">194</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col8" class="data row1 col8">225</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col9" class="data row1 col9">98</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col10" class="data row1 col10">5</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col11" class="data row1 col11">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col12" class="data row1 col12">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row1_col13" class="data row1 col13">0</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row2" class="row_heading level0 row2">2</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col0" class="data row2 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col1" class="data row2 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col2" class="data row2 col2">14</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col3" class="data row2 col3">209</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col4" class="data row2 col4">253</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col5" class="data row2 col5">242</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col6" class="data row2 col6">242</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col7" class="data row2 col7">242</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col8" class="data row2 col8">251</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col9" class="data row2 col9">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col10" class="data row2 col10">183</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col11" class="data row2 col11">9</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col12" class="data row2 col12">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row2_col13" class="data row2 col13">0</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row3" class="row_heading level0 row3">3</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col0" class="data row3 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col1" class="data row3 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col2" class="data row3 col2">25</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col3" class="data row3 col3">228</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col4" class="data row3 col4">95</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col5" class="data row3 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col6" class="data row3 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col7" class="data row3 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col8" class="data row3 col8">113</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col9" class="data row3 col9">250</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col10" class="data row3 col10">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col11" class="data row3 col11">219</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col12" class="data row3 col12">24</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row3_col13" class="data row3 col13">0</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row4" class="row_heading level0 row4">4</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col0" class="data row4 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col1" class="data row4 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col2" class="data row4 col2">11</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col3" class="data row4 col3">41</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col4" class="data row4 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col5" class="data row4 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col6" class="data row4 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col7" class="data row4 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col8" class="data row4 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col9" class="data row4 col9">80</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col10" class="data row4 col10">210</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col11" class="data row4 col11">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col12" class="data row4 col12">167</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row4_col13" class="data row4 col13">22</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row5" class="row_heading level0 row5">5</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col0" class="data row5 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col1" class="data row5 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col2" class="data row5 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col3" class="data row5 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col4" class="data row5 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col5" class="data row5 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col6" class="data row5 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col7" class="data row5 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col8" class="data row5 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col9" class="data row5 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col10" class="data row5 col10">75</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col11" class="data row5 col11">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col12" class="data row5 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row5_col13" class="data row5 col13">113</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row6" class="row_heading level0 row6">6</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col0" class="data row6 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col1" class="data row6 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col2" class="data row6 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col3" class="data row6 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col4" class="data row6 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col5" class="data row6 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col6" class="data row6 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col7" class="data row6 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col8" class="data row6 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col9" class="data row6 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col10" class="data row6 col10">28</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col11" class="data row6 col11">223</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col12" class="data row6 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row6_col13" class="data row6 col13">161</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row7" class="row_heading level0 row7">7</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col0" class="data row7 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col1" class="data row7 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col2" class="data row7 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col3" class="data row7 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col4" class="data row7 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col5" class="data row7 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col6" class="data row7 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col7" class="data row7 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col8" class="data row7 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col9" class="data row7 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col10" class="data row7 col10">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col11" class="data row7 col11">124</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col12" class="data row7 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row7_col13" class="data row7 col13">223</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row8" class="row_heading level0 row8">8</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col0" class="data row8 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col1" class="data row8 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col2" class="data row8 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col3" class="data row8 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col4" class="data row8 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col5" class="data row8 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col6" class="data row8 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col7" class="data row8 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col8" class="data row8 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col9" class="data row8 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col10" class="data row8 col10">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col11" class="data row8 col11">82</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col12" class="data row8 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row8_col13" class="data row8 col13">254</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row9" class="row_heading level0 row9">9</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col0" class="data row9 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col1" class="data row9 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col2" class="data row9 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col3" class="data row9 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col4" class="data row9 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col5" class="data row9 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col6" class="data row9 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col7" class="data row9 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col8" class="data row9 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col9" class="data row9 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col10" class="data row9 col10">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col11" class="data row9 col11">82</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col12" class="data row9 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row9_col13" class="data row9 col13">254</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row10" class="row_heading level0 row10">10</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col0" class="data row10 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col1" class="data row10 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col2" class="data row10 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col3" class="data row10 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col4" class="data row10 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col5" class="data row10 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col6" class="data row10 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col7" class="data row10 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col8" class="data row10 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col9" class="data row10 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col10" class="data row10 col10">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col11" class="data row10 col11">82</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col12" class="data row10 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row10_col13" class="data row10 col13">254</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row11" class="row_heading level0 row11">11</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col0" class="data row11 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col1" class="data row11 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col2" class="data row11 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col3" class="data row11 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col4" class="data row11 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col5" class="data row11 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col6" class="data row11 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col7" class="data row11 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col8" class="data row11 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col9" class="data row11 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col10" class="data row11 col10">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col11" class="data row11 col11">115</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col12" class="data row11 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row11_col13" class="data row11 col13">229</td>
            </tr>
            <tr>
                        <th id="T_b5b971e0_0254_11eb_bcbe_0242ac110002level0_row12" class="row_heading level0 row12">12</th>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col0" class="data row12 col0">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col1" class="data row12 col1">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col2" class="data row12 col2">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col3" class="data row12 col3">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col4" class="data row12 col4">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col5" class="data row12 col5">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col6" class="data row12 col6">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col7" class="data row12 col7">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col8" class="data row12 col8">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col9" class="data row12 col9">0</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col10" class="data row12 col10">23</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col11" class="data row12 col11">220</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col12" class="data row12 col12">254</td>
                        <td id="T_b5b971e0_0254_11eb_bcbe_0242ac110002row12_col13" class="data row12 col13">161</td>
            </tr>
    </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Measuring-the-difference:-Pixel-similarity">
<a class="anchor" href="#Measuring-the-difference:-Pixel-similarity" aria-hidden="true"><span class="octicon octicon-link"></span></a>Measuring the difference: Pixel similarity<a class="anchor-link" href="#Measuring-the-difference:-Pixel-similarity"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One straight-forward way to categorize the images would be to measure pixel similarity.</p>
<p>That is, for every digit, we take all of the images from the training set, and for each pixel we calculate the average value.</p>
<p>To classify new number, we compare each pixel of this new number with the corresponding "average" pixel of a digit. We classify it as a digit where the difference was smallest.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id='Creating-"average"-digits'>
<a class="anchor" href="#Creating-" average aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating "average" digits<a class="anchor-link" href="#Creating-%22average%22-digits"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, we convert the digit images to tensors.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">digit_tensors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">d_images</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
    <span class="n">digit_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tensor</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">o</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">d_images</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">d_tensors</span> <span class="ow">in</span> <span class="n">digit_tensors</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_tensors</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5923, 6742, 5958, 6131, 5842, 5421, 5918, 6265, 5851, 5949, </pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To calculate the average pixel values of a digit, we need to stack all of the corresponding digits to a single three-dimensional tensor - <em>rank-3 tensor</em>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stacked_digit_tensors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">digit_tensors</span><span class="p">:</span>
    <span class="n">stacked_current</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">/</span><span class="mi">255</span>
    <span class="n">stacked_digit_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stacked_current</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And calculate the mean.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">digit_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s_d</span> <span class="ow">in</span> <span class="n">stacked_digit_tensors</span><span class="p">:</span>
    <span class="n">digit_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_d</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see how an "ideal" 2 looks like.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_image</span><span class="p">(</span><span class="n">digit_means</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;AxesSubplot:&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the whole range.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_images</span><span class="p">(</span><span class="n">digit_means</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To recap, this digits are just average values of every pixel for a given digit.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Measuring-the-similarity">
<a class="anchor" href="#Measuring-the-similarity" aria-hidden="true"><span class="octicon octicon-link"></span></a>Measuring the similarity<a class="anchor-link" href="#Measuring-the-similarity"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are two main ways to measure the similarity of the images:</p>
<ol>
<li>Mean of the <strong>absolute value of differences</strong> - <em>mean absolute difference</em> - <em>L1 norm</em>
</li>
<li>Mean of the <strong>square of differences</strong> - <em>root mean squared error</em> - <em>L2 norm</em>
</li>
</ol>
<p>The main difference is that the latter penalizes bigger differences more.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We're going to use both techniques.
We start by picking a random two digit. Then, compare it to an ideal 2 and ideal 4.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a_2</span> <span class="o">=</span> <span class="n">stacked_digit_tensors</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mean_2</span> <span class="o">=</span> <span class="n">digit_means</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">mean_4</span> <span class="o">=</span> <span class="n">digit_means</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">show_images</span><span class="p">([</span><span class="n">a_2</span><span class="p">,</span> <span class="n">mean_2</span><span class="p">,</span> <span class="n">mean_4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>L1-norm with our random 2:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist_2_abs</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_2</span> <span class="o">-</span> <span class="n">mean_2</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">dist_2_abs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(0.1350)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>a_2 - mean_2</code> returns a tensor - differences for every pixel.
Then, mean is calculated from absolute values of the differences.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_image</span><span class="p">(</span><span class="n">a_2</span> <span class="o">-</span> <span class="n">mean_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;AxesSubplot:&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>L2-norm:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist_2_sqr</span> <span class="o">=</span> <span class="p">((</span><span class="n">a_2</span> <span class="o">-</span> <span class="n">mean_2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">dist_2_sqr</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(0.0547)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, compare the random 2 to ideal 4.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dist_4_abs</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_2</span> <span class="o">-</span> <span class="n">mean_4</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">dist_4_sqr</span> <span class="o">=</span> <span class="p">((</span><span class="n">a_2</span> <span class="o">-</span> <span class="n">mean_4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">dist_4_abs</span><span class="p">,</span> <span class="n">dist_4_sqr</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor(0.1750), tensor(0.1036))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In both cases, the distance to the mean-4 is greater than the distance to the mean 2 - so the model would pick the right number.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>PyTorch comes with both of these loss functions in <code>torch.nn.functional</code> as <code>l1_loss</code> and <code>mse_loss</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">l1_loss</span><span class="p">(</span><span class="n">a_2</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span><span class="n">mean_2</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">a_2</span><span class="p">,</span><span class="n">mean_2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor(0.1350), tensor(0.2338))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculating-accuracy">
<a class="anchor" href="#Calculating-accuracy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calculating accuracy<a class="anchor-link" href="#Calculating-accuracy"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we would like to see how good the predictions actually are. We can find out by using digits from validation set and comparing the predictions to actual values.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">validation_digits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">valid_current</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">tensor</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">o</span><span class="p">))</span> 
                            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">'testing'</span><span class="o">/</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">ls</span><span class="p">()])</span>
    <span class="n">valid_current</span> <span class="o">=</span> <span class="n">valid_current</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">/</span><span class="mi">255</span>
    <span class="n">validation_digits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_current</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">validation_digits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([1010, 28, 28])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A function to calculate distance between two tensors. It utilizes <em>broadcasting</em> - automatically expanding smaller rank tensor if the ranks of tensor arguments don't match.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mnist_distance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Same rank:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mnist_distance</span><span class="p">(</span><span class="n">a_2</span><span class="p">,</span> <span class="n">mean_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(0.1350)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Non-matching rank:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mnist_distance</span><span class="p">(</span><span class="n">validation_digits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">mean_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([0.1275, 0.1369, 0.1477,  ..., 0.1503, 0.1582, 0.1609])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that this doesn't actually <em>create</em> new copies of <code>mean_2</code> - it just behaves like it did.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll use this <code>mnist_distance</code> to classify images. We guess the image to represent number where it had smallest distance from the mean image.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_target</span><span class="p">(</span><span class="n">tns</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">target_mean</span> <span class="o">=</span> <span class="n">digit_means</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
    <span class="n">other_means</span> <span class="o">=</span> <span class="n">digit_means</span><span class="p">[:</span><span class="n">target</span><span class="p">]</span> <span class="o">+</span> <span class="n">digit_means</span><span class="p">[</span><span class="n">target</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">intermed_tns</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">([</span><span class="kc">True</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">o_mean</span> <span class="ow">in</span> <span class="n">other_means</span><span class="p">:</span>
        <span class="n">target_dist</span> <span class="o">=</span> <span class="n">mnist_distance</span><span class="p">(</span><span class="n">tns</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">)</span> 
        <span class="n">o_dist</span> <span class="o">=</span> <span class="n">mnist_distance</span><span class="p">(</span><span class="n">tns</span><span class="p">,</span> <span class="n">o_mean</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">target_dist</span> <span class="o">&lt;</span> <span class="n">o_dist</span>
        <span class="n">intermed_tns</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">intermed_tns</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">intermed_tns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc_sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">is_target</span><span class="p">(</span><span class="n">stacked_digit_tensors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
    <span class="n">acc_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mean accuracy: </span><span class="si">{</span><span class="n">acc_sum</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0: 81.41%
1: 99.81%
2: 43.29%
3: 58.36%
4: 66.48%
5: 30.01%
6: 74.54%
7: 77.78%
8: 39.58%
9: 71.63%
Mean accuracy: 64.29%
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, the predictions are all over the place, but the result is not bad - more than 6 times better than random guesses.
<em>Note: Extremely high accuracy with predicting 1s is a little unsettling and looks like a bug - if it is, I wasn't able to locate it.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Stochastic-Gradient-Descent">
<a class="anchor" href="#Stochastic-Gradient-Descent" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stochastic Gradient Descent<a class="anchor-link" href="#Stochastic-Gradient-Descent"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>SGD: Find local minima of a loss function by changing the parameters. Adjust the rate at which each parameter changes by calculating gradients (steepness of the slope).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Steps</strong></p>
<ol>
<li>Initialize weights randomly</li>
<li>Calculate the predictions </li>
<li>Calculate the loss</li>
<li>Calculate the gradients</li>
<li>Step the weights</li>
<li>Repeat</li>
<li>End</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before we begin, we create a dataset that contains <code>digit tensor, label</code> pairs.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">stacked_digit_tensors</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([60000, 784]), torch.Size([60000, 1]))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span><span class="n">train_y</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([784]), torch.Size([1]))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Same for validation set:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">valid_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">validation_digits</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">validation_digits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">valid_y</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">valid_dset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">valid_x</span><span class="p">,</span> <span class="n">valid_y</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 1: Initialize the parameters randomly</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">init_params</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">*</span><span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We want the weights to output in 10 dimensions - 1 for each digit.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">((</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If all the pixels would be 0, no matter the weights, the function would return zero. To avoid this, we include <em>bias</em> - that is the <em>b</em> in w*x+b.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bias</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-2:-Calculate-the-predictions">
<a class="anchor" href="#Step-2:-Calculate-the-predictions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2: Calculate the predictions<a class="anchor-link" href="#Step-2:-Calculate-the-predictions"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can calculate the prediction now.
We'll use <em>matrix multiplication</em> to calculate w*x for every row in a matrix.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">linear1</span><span class="p">(</span><span class="n">xb</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">xb</span><span class="nd">@weights</span> <span class="o">+</span> <span class="n">bias</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">linear1</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">preds</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([-11.9867,  -4.2706,   4.6806,   8.3393,   2.6384,   8.4428,  -5.3335,  -1.3517,  -0.0395,  13.5840], grad_fn=&lt;SelectBackward&gt;),
 torch.Size([60000, 10]))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-3:-Calculate-the-loss">
<a class="anchor" href="#Step-3:-Calculate-the-loss" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3: Calculate the loss<a class="anchor-link" href="#Step-3:-Calculate-the-loss"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can calculate the accuracy of our model now.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">p_to_digit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p_to_digit</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span> <span class="o">==</span> <span class="n">yb</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To do that, we need to convert the prediction tensor to a digit by picking up a digit with highest confidence.</p>
<p>Then we just compare if the predicted digit is equal to the label.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To test this, pick two numbers with labels and calculate their predictions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">two_numbers</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">train_x</span><span class="p">[</span><span class="mi">10000</span><span class="p">:</span><span class="mi">10002</span><span class="p">])</span>
<span class="n">two_labels</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">(</span><span class="n">train_y</span><span class="p">[</span><span class="mi">10000</span><span class="p">:</span><span class="mi">10002</span><span class="p">])</span>
<span class="n">two_preds</span> <span class="o">=</span> <span class="n">linear1</span><span class="p">(</span><span class="n">two_numbers</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">two_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([ 1.0390,  3.3584, -4.7083, -6.4347, -7.8454, -1.6740,  5.4817, -4.1297, 16.2386, 13.1670], grad_fn=&lt;SelectBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_to_digit</span><span class="p">(</span><span class="n">two_preds</span><span class="p">),</span> <span class="n">two_labels</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([8, 8]),
 tensor([[1],
         [1]]))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">accuracy</span><span class="p">(</span><span class="n">two_preds</span><span class="p">,</span> <span class="n">two_labels</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(0.)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We get around ~10% accuracy, as would expect.
We want to use gradients to improve our model using SGD. We could use accuracy as our <em>loss function</em>.
But there's a problem. Gradients are calculated over the slope of the function  (<em>rise over run</em>). Now, some changes to the parameters might not be enough to change the prediction to different number.</p>
<p>We need a loss function that changes <em>everytime</em> we tweak the parameters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can do this by predicting not only the digit, but also the <em>confidence</em> of the prediction.
We use <a href="https://pytorch.org/docs/stable/nn.functional.html#torch.nn.functional.softmax">softmax</a> to keep the predictions in [0,1] interval proportional to the original values.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before writing the loss function, we need to come up with a way to convert labels to tensor expressing <em>confidences</em> for every digit. That is, it should have a value <strong>1</strong> for the target digit, and <strong>0</strong> for every other digit. The loss will use this tensor to calculate the distance from the desired answer.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">label_to_tensor</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">scatter_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mnist_loss</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">label_to_tensor</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-4:-Calculate-the-gradients">
<a class="anchor" href="#Step-4:-Calculate-the-gradients" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4: Calculate the gradients<a class="anchor-link" href="#Step-4:-Calculate-the-gradients"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Calculating the loss one item at a time would be too slow, but doing it all at once would take a long time. We settle for a compromise: <em>mini-batches</em> - calculation are taken on a batch of items at a time.
This also utilizes GPUs capabilities to perform tasks in pararel.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">valid_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>

<span class="n">weights</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">((</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">bias</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calc_grad</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">mnist_loss</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">yb</span><span class="p">)</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<p><strong>Training</strong></p>
<ul>
<li>When training, we step in the opposite direction of the gradient to move to the function minima.</li>
<li>Don't forget to zero out the gradients to avoid them being added together after multiple runs.</li>
<li>
<em>Learning rate</em> is used to adjust the size of the steps - to augment the gradients impact.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="ow">in</span> <span class="n">dl</span><span class="p">:</span>
        <span class="n">calc_grad</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">*</span><span class="n">lr</span>
            <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">validate_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">accs</span> <span class="o">=</span> <span class="p">[</span><span class="n">accuracy</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">),</span> <span class="n">yb</span><span class="p">)</span> <span class="k">for</span> <span class="n">xb</span><span class="p">,</span><span class="n">yb</span> <span class="ow">in</span> <span class="n">valid_dl</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">validate_epoch</span><span class="p">(</span><span class="n">linear1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.1019</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With random weights, the ~10% shouldn't surprise us.
But does it actually get better if we <em>train</em> the model?</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span><span class="n">bias</span>
<span class="n">train_epoch</span><span class="p">(</span><span class="n">linear1</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="n">validate_epoch</span><span class="p">(</span><span class="n">linear1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.179</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It does!</p>
<p>We can train some more.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span><span class="n">bias</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">train_epoch</span><span class="p">(</span><span class="n">linear1</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">validate_epoch</span><span class="p">(</span><span class="n">linear1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">' '</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.2245 0.2615 0.2982 0.3306 0.3526 0.3692 0.3823 0.3964 0.4115 0.4234 0.4365 0.4467 0.455 0.4641 0.471 0.4791 0.4859 0.4942 0.5069 0.5257 </pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The accuracy after a few training cycles reaches ~50%, which is quite good, for such a simple model!</p>
<p>Altough the pixel similarity model worked better, this is a basic block which we can build on. And it's actually <em>learning</em>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Creating-an-Optimizer">
<a class="anchor" href="#Creating-an-Optimizer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating an Optimizer<a class="anchor-link" href="#Creating-an-Optimizer"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unsurprisingly, there's bunch of PyTorch classes that make this easier to implement. 
<em>nn.Linear</em> is a combination of our <em>init_params</em> and <em>linear1</em>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">linear_model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">linear_model</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Linear(in_features=784, out_features=10, bias=True)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A purpose of the <em>optimizer</em> is to minimalize the loss function by stepping the weights, as we've done in <em>calc_grad</em> and <em>train_epoch</em>.</p>
<p><em>fastai</em> provides <em>SGD</em>, which does essentialy the same as we did.</p>
<p>We can use <em>Learner</em> to put it all together.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">SGD</span><span class="p">,</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">mnist_loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.177227</td>
      <td>0.160779</td>
      <td>0.193971</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.103887</td>
      <td>0.155185</td>
      <td>0.221862</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.069117</td>
      <td>0.139903</td>
      <td>0.309807</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.059987</td>
      <td>0.128441</td>
      <td>0.360148</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.054112</td>
      <td>0.118848</td>
      <td>0.401384</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.051850</td>
      <td>0.110999</td>
      <td>0.440786</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.050422</td>
      <td>0.105058</td>
      <td>0.467323</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.049435</td>
      <td>0.100271</td>
      <td>0.487337</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.048716</td>
      <td>0.096281</td>
      <td>0.502976</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.048168</td>
      <td>0.092869</td>
      <td>0.518368</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.047717</td>
      <td>0.089898</td>
      <td>0.531261</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.047225</td>
      <td>0.087264</td>
      <td>0.542448</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>12</td>
      <td>0.045476</td>
      <td>0.085328</td>
      <td>0.554211</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>13</td>
      <td>0.042950</td>
      <td>0.083419</td>
      <td>0.564423</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>14</td>
      <td>0.041798</td>
      <td>0.080433</td>
      <td>0.581772</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>15</td>
      <td>0.041192</td>
      <td>0.077971</td>
      <td>0.593313</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>16</td>
      <td>0.040762</td>
      <td>0.075869</td>
      <td>0.604204</td>
      <td>00:00</td>
    </tr>
    <tr>
      <td>17</td>
      <td>0.040386</td>
      <td>0.073986</td>
      <td>0.611360</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>18</td>
      <td>0.040054</td>
      <td>0.072248</td>
      <td>0.619918</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>19</td>
      <td>0.039764</td>
      <td>0.070627</td>
      <td>0.627427</td>
      <td>00:00</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This performs slightly better than our model. My guess would be that <em>SGD</em> optimizer is slightly more advanced than ours. I'll update this when I find out.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can advance to crucial step - adding more layers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="More-layers-and-nonlinearity">
<a class="anchor" href="#More-layers-and-nonlinearity" aria-hidden="true"><span class="octicon octicon-link"></span></a>More layers and nonlinearity<a class="anchor-link" href="#More-layers-and-nonlinearity"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we added only another (linear) layer, those two layers could be modified (by using calculus) to be represented as a single linear function.
The solution is to add a <strong>nonlinear</strong> function between the two.</p>
<p>Now, it's not possible to simplify it to single linear function.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simple_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="c1"># linear layer</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span> <span class="c1"># nonlinearity</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># linear layer</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>nn.ReLU</em> is essentialy <em>max(0, x)</em>. It turns any negative numbers to zero, leaving positive numbers untouched.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_function</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">simple_net</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">SGD</span><span class="p">,</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">mnist_loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.181457</td>
      <td>0.178528</td>
      <td>0.217043</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.180678</td>
      <td>0.175846</td>
      <td>0.250777</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.180115</td>
      <td>0.169476</td>
      <td>0.265250</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.178958</td>
      <td>0.155737</td>
      <td>0.298626</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.174436</td>
      <td>0.142253</td>
      <td>0.325580</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.169929</td>
      <td>0.132780</td>
      <td>0.346405</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.165284</td>
      <td>0.125421</td>
      <td>0.414369</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.159455</td>
      <td>0.121954</td>
      <td>0.414507</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.152856</td>
      <td>0.117419</td>
      <td>0.415911</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.148755</td>
      <td>0.110323</td>
      <td>0.435318</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.146101</td>
      <td>0.104967</td>
      <td>0.458405</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.144515</td>
      <td>0.100603</td>
      <td>0.487237</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>12</td>
      <td>0.143508</td>
      <td>0.097081</td>
      <td>0.506937</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>13</td>
      <td>0.142821</td>
      <td>0.094319</td>
      <td>0.519657</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>14</td>
      <td>0.142342</td>
      <td>0.091932</td>
      <td>0.525919</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>15</td>
      <td>0.141677</td>
      <td>0.088836</td>
      <td>0.543320</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>16</td>
      <td>0.140684</td>
      <td>0.086376</td>
      <td>0.555296</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>17</td>
      <td>0.140261</td>
      <td>0.083856</td>
      <td>0.566285</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>18</td>
      <td>0.139943</td>
      <td>0.081593</td>
      <td>0.575492</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>19</td>
      <td>0.139685</td>
      <td>0.079630</td>
      <td>0.582533</td>
      <td>00:01</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The results are slightly disappointing - the accuracy after 20 cycles is similar to our single-layer model.
What happens if we add another layer?</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bigger_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b_learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">bigger_net</span><span class="p">,</span> <span class="n">opt_func</span><span class="o">=</span><span class="n">SGD</span><span class="p">,</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">mnist_loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b_learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.180283</td>
      <td>0.179822</td>
      <td>0.102665</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.180089</td>
      <td>0.179545</td>
      <td>0.153138</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.179895</td>
      <td>0.179211</td>
      <td>0.156936</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.179665</td>
      <td>0.178729</td>
      <td>0.203679</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.179366</td>
      <td>0.178033</td>
      <td>0.228775</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.179014</td>
      <td>0.176945</td>
      <td>0.250143</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.178602</td>
      <td>0.175029</td>
      <td>0.289143</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.177946</td>
      <td>0.171027</td>
      <td>0.352468</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.176338</td>
      <td>0.164895</td>
      <td>0.396136</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.173490</td>
      <td>0.157322</td>
      <td>0.405480</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.166507</td>
      <td>0.145020</td>
      <td>0.432024</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.150122</td>
      <td>0.139409</td>
      <td>0.406573</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>12</td>
      <td>0.112806</td>
      <td>0.151245</td>
      <td>0.242496</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>13</td>
      <td>0.091888</td>
      <td>0.147225</td>
      <td>0.259661</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>14</td>
      <td>0.093092</td>
      <td>0.134118</td>
      <td>0.330245</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>15</td>
      <td>0.079503</td>
      <td>0.127339</td>
      <td>0.360524</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>16</td>
      <td>0.066946</td>
      <td>0.123373</td>
      <td>0.377670</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>17</td>
      <td>0.059357</td>
      <td>0.119408</td>
      <td>0.392566</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>18</td>
      <td>0.055211</td>
      <td>0.115639</td>
      <td>0.404702</td>
      <td>00:01</td>
    </tr>
    <tr>
      <td>19</td>
      <td>0.052592</td>
      <td>0.112473</td>
      <td>0.415865</td>
      <td>00:01</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model got even worse!</p>
<p><em>What is going on here?</em>
Frankly, I don't know. Perhaps I should pick other <em>learning rate</em>? Or my loss function is off. Maybe I'm missing something wholly different.</p>
<p>But glance at the internet reveals there might be other problems:</p>
<ul>
<li>
<em>overfitting</em> caused by more layers</li>
<li>problem with <em>initializing the weights</em>
</li>
<li>problem with gradients (e.g. <em>vanishing gradient</em>)</li>
</ul>
<p>Since I'm still only at the beginning of my ML journey, I can't easily solve the problem. I hope to update this blog when I'll find out what's the deal here.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Final-remarks">
<a class="anchor" href="#Final-remarks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final remarks<a class="anchor-link" href="#Final-remarks"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this blog, we've gone through comparing images by pixel similarity to working neural network learning through SGD. Even if the results were a bit disappointing, it was clear that the model <em>learned</em> and gradually improved the performance - even with starting out with completely random values!</p>
<p>I was surprised by the simplicity of the SGD. You pick a random weights and the nudge them into the right direction to minimize the loss function, and you can adjust the "nudge" by how steep the change is. So cool!</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="jac08h/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/programming/fastai/2020/09/24/digits-classifier.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/jac08h" title="jac08h"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>
  </div>

</footer>
</body>

</html>
